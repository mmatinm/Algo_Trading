
//@version=5
indicator("volume anomaly", overlay=true)

length = input.int(title="Volume SMA length", defval=7)
n = input.float(title="volume limit (ratio)", defval=3)

Shortanomaly = false
Longanomaly = false

bodyLength = close - open
volumeToBodyRatio = volume / bodyLength
meanVolume = ta.sma(volume,length)
meanbody = ta.sma(close-open,length)

if (volume > (n*meanVolume)) and (bodyLength > 0)
    if (bodyLength < meanbody/n ) or (high-close > meanbody)
        Shortanomaly := true
    //
//
if (volume > (n*meanVolume)) and (bodyLength < 0)
    if (bodyLength > meanbody/n ) or (low-close < meanbody)
        Longanomaly := true
    //
//

//plot(volumeToBodyRatio, color=color.blue, title="Volume to Body Ratio", linewidth=2)
plotshape(series=Shortanomaly, color=color.red, style=shape.triangledown, location=location.abovebar, size=size.small)
plotshape(series=Longanomaly, color=color.green, style=shape.triangleup, location=location.belowbar, size=size.small)
